# CAMS Services – Railway Deployment Guide
# Railway uses railway.toml or railway.json per service (see backend/railway.toml, frontend/railway.toml).
# This file is the deployment reference; create services in Railway Dashboard and set each service's "Root Directory" accordingly.
#
# Reverb (WebSockets): Railway supports WSS on web services. Use REVERB_APP_PING_INTERVAL=30 for keepalive.
# Queue/scheduler: Run in-container via backend entrypoint (RUN_QUEUE_IN_CONTAINER, RUN_SCHEDULER_IN_CONTAINER)
# or add separate Railway services for worker and cron when on a paid plan.
#
# PostgreSQL: Add a PostgreSQL plugin in the same Railway project; variables are linked automatically.

# =============================================================================
# SERVICES (create each in Railway Dashboard; root directory and config per service)
# =============================================================================

# --- 1. Backend (Laravel API) ---
# Root Directory: backend
# Config: backend/railway.toml
# Dockerfile: backend/Dockerfile
# APP_URL is set from RAILWAY_PUBLIC_DOMAIN in docker-entrypoint.sh

# --- 2. Reverb (WebSocket server, optional) ---
# Root Directory: backend (same as backend; use RUN_MODE=reverb)
# Create a second service from same repo, Root Directory: backend.
# Set RUN_MODE=reverb and same APP_KEY/DB/Reverb credentials as backend.
# No separate railway.toml needed unless you want a custom healthcheck (Reverb has no HTTP by default).

# --- 3. Frontend (Next.js) ---
# Root Directory: frontend
# Config: frontend/railway.toml
# Dockerfile: frontend/Dockerfile

# --- 4. Database ---
# Add PostgreSQL via Railway Dashboard → New → Database → PostgreSQL.
# Reference in backend (and Reverb) via Railway-linked variables (e.g. DATABASE_URL or separate DB_* vars).

# =============================================================================
# ENVIRONMENT VARIABLES (set in Railway Dashboard → each service → Variables)
# =============================================================================

# ----- Backend (cams-backend) -----
# Application
#   APP_NAME = CAMS Services
#   APP_ENV = production
#   APP_DEBUG = false
#   APP_KEY = (generate: php artisan key:generate --show)
#   APP_TIMEZONE = UTC
#   APP_URL = https://<your-backend>.up.railway.app  (or leave unset; entrypoint sets from RAILWAY_PUBLIC_DOMAIN)
#
# Database (from Railway PostgreSQL plugin or manual)
#   DB_CONNECTION = pgsql
#   DB_HOST = (from PostgreSQL plugin: ${{Postgres.PGHOST}} or variable reference)
#   DB_PORT = 5432
#   DB_DATABASE = ${{Postgres.PGDATABASE}}
#   DB_USERNAME = ${{Postgres.PGUSER}}
#   DB_PASSWORD = ${{Postgres.PGPASSWORD}}
#
# Cache & session (ephemeral filesystem; use database)
#   CACHE_STORE = database
#   SESSION_DRIVER = database
#   QUEUE_CONNECTION = database
#   RUN_QUEUE_IN_CONTAINER = true
#   RUN_SCHEDULER_IN_CONTAINER = true
#   SESSION_LIFETIME = 120
#
# Logging
#   LOG_CHANNEL = errorlog
#   LOG_LEVEL = error
#
# Mail (set your SMTP provider)
#   MAIL_MAILER = smtp
#   MAIL_HOST, MAIL_PORT, MAIL_USERNAME, MAIL_PASSWORD, MAIL_ENCRYPTION
#   MAIL_FROM_ADDRESS = noreply@camsservice.co.uk
#   MAIL_FROM_NAME = CAMS Services
#
# Frontend integration
#   FRONTEND_URL = https://<your-frontend>.up.railway.app
#   SANCTUM_STATEFUL_DOMAINS = <frontend-host>,<backend-host>
#   SESSION_DOMAIN = .railway.app (or leave unset; entrypoint sets for Railway)
#   CORS_ALLOWED_ORIGINS = https://<your-frontend>.up.railway.app
#
# Next.js revalidation
#   NEXT_REVALIDATE_URL = https://<your-frontend>.up.railway.app/api/revalidate
#   NEXT_REVALIDATE_SECRET = (secure random string)
#
# Stripe
#   STRIPE_SECRET_KEY, STRIPE_PUBLIC_KEY, STRIPE_WEBHOOK_SECRET
#
# Reverb (if using cams-reverb service)
#   BROADCAST_CONNECTION = reverb
#   REVERB_APP_ID = 1
#   REVERB_APP_KEY, REVERB_APP_SECRET (set same on Reverb service and frontend NEXT_PUBLIC_REVERB_APP_KEY)
#   REVERB_HOST = (Reverb service private host or 0.0.0.0 inside Reverb container)
#   REVERB_PORT = 8080

# ----- Reverb (cams-reverb, optional) -----
#   RUN_MODE = reverb
#   APP_KEY, APP_ENV, APP_URL (Reverb public URL for Laravel bootstrap)
#   DB_* (same as backend)
#   BROADCAST_CONNECTION = reverb
#   REVERB_APP_ID, REVERB_APP_KEY, REVERB_APP_SECRET
#   REVERB_HOST = 0.0.0.0
#   REVERB_PORT = 8080 (or $PORT; entrypoint uses PORT)
#   REVERB_SCHEME = https
#   REVERB_APP_PING_INTERVAL = 30

# ----- Frontend (cams-frontend) -----
#   NODE_ENV = production
#   NEXT_TELEMETRY_DISABLED = 1
#   NEXT_PUBLIC_SITE_URL = https://<your-frontend>.up.railway.app
#   NEXT_PUBLIC_SITE_NAME = CAMS Services
#   NEXT_PUBLIC_API_URL = https://<your-backend>.up.railway.app/api/v1
#   API_URL = https://<your-backend>.up.railway.app/api/v1
#   NEXT_PUBLIC_PACKAGE_REPOSITORY = api
#   NEXT_PUBLIC_SERVICE_REPOSITORY = api
#   NEXT_PUBLIC_TRAINER_REPOSITORY = api
#   NEXT_PUBLIC_PAGE_REPOSITORY = api
#   NEXT_PUBLIC_FAQ_REPOSITORY = api
#   NEXT_PUBLIC_BLOG_REPOSITORY = api
#   NEXT_REVALIDATE_SECRET = (match backend)
#   NEXT_PUBLIC_LIVE_REFRESH_WEBSOCKET_ENABLED = false (or true when Reverb is always-on)
#   NEXT_PUBLIC_REVERB_APP_KEY, NEXT_PUBLIC_REVERB_WS_HOST, NEXT_PUBLIC_REVERB_WS_PORT = 443, NEXT_PUBLIC_REVERB_SCHEME = https
#   NEXT_PUBLIC_STRIPE_PUBLIC_KEY
#   NEXT_PUBLIC_IDEAL_POSTCODES_API_KEY (optional)
#   NEXT_PUBLIC_GOOGLE_MAPS_API_KEY (optional)

# =============================================================================
# DEPLOYMENT OPTIONS (Backend)
# =============================================================================
# Option A (current): Docker – backend/Dockerfile, Nginx + PHP-FPM. No startCommand; entrypoint handles PORT and APP_URL.
# Option B: Native PHP – set Root Directory to backend and use Nixpacks/Railpack with startCommand:
#   php artisan config:cache && php artisan serve --host=0.0.0.0 --port=$PORT
# For Option A, ensure service uses Dockerfile (builder DOCKERFILE) and root directory = backend.

# =============================================================================
# NOTES
# =============================================================================
# - Railway sets PORT automatically; backend Dockerfile/entrypoint use it.
# - RAILWAY_PUBLIC_DOMAIN is set by Railway; docker-entrypoint.sh sets APP_URL from it.
# - For PostgreSQL, use Railway's Postgres plugin and reference variables (e.g. DATABASE_URL or DB_*).
# - Run migrations: set a one-off deploy or use preDeployCommand in backend/railway.toml (e.g. php artisan migrate --force).
